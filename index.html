<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expert Researcher - Semantic Scholar API</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold mb-8 text-center text-gray-800">Expert Researcher</h1>
        
        <!-- Search Form -->
        <div class="mb-8 max-w-2xl mx-auto">
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-xl font-semibold mb-4">Search Papers</h2>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Search Query</label>
                        <input type="text" id="searchQuery" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                               placeholder="Enter search terms...">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Year Range</label>
                        <div class="grid grid-cols-2 gap-4">
                            <input type="number" id="yearStart" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                   placeholder="Start year">
                            <input type="number" id="yearEnd" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                   placeholder="End year">
                        </div>
                    </div>
                    <button onclick="searchPapers()" 
                            class="w-full bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        Search
                    </button>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="max-w-4xl mx-auto">
            <div id="loading" class="hidden text-center py-4">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto"></div>
            </div>
            <div id="results" class="space-y-4"></div>
            <div id="pagination" class="mt-4 text-center hidden">
                <button onclick="loadMore()" 
                        class="bg-gray-500 text-white py-2 px-4 rounded-md hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500">
                    Load More
                </button>
            </div>
        </div>
    </div>

    <script>
        let nextToken = null;
        let currentQuery = '';
        let currentYearStart = '';
        let currentYearEnd = '';

        async function searchPapers(useToken = false) {
            const query = useToken ? currentQuery : document.getElementById('searchQuery').value;
            const yearStart = useToken ? currentYearStart : document.getElementById('yearStart').value;
            const yearEnd = useToken ? currentYearEnd : document.getElementById('yearEnd').value;
            
            if (!useToken) {
                // New search, reset results
                document.getElementById('results').innerHTML = '';
                nextToken = null;
                currentQuery = query;
                currentYearStart = yearStart;
                currentYearEnd = yearEnd;
            }

            const loading = document.getElementById('loading');
            loading.classList.remove('hidden');

            try {
                let url = `https://api.semanticscholar.org/graph/v1/paper/search?query=${encodeURIComponent(query)}&fields=title,year,authors,abstract,citationCount,fieldsOfStudy`;

                if (yearStart && yearEnd) {
                    url += `&year=${yearStart}-${yearEnd}`;
                }
                if (nextToken) {
                    url += `&token=${nextToken}`;
                }

                const response = await fetch(url);
                const data = await response.json();

                nextToken = data.token;
                displayResults(data);

            } catch (error) {
                console.error('Error fetching data:', error);
                document.getElementById('results').innerHTML += `
                    <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
                        Error fetching results. Please try again.
                    </div>
                `;
            } finally {
                loading.classList.add('hidden');
            }
        }

        function displayResults(data) {
            const resultsDiv = document.getElementById('results');
            const paginationDiv = document.getElementById('pagination');

            if (data.data && data.data.length > 0) {
                data.data.forEach(paper => {
                    const authors = paper.authors ? paper.authors.map(author => author.name).join(', ') : 'No authors listed';
                    const abstract = paper.abstract || 'No abstract available';
                    const citationCount = paper.citationCount || 0;
                    const fieldsOfStudy = paper.fieldsOfStudy ? paper.fieldsOfStudy.join(', ') : 'Not specified';

                    resultsDiv.innerHTML += `
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-xl font-semibold mb-2">${paper.title}</h3>
                            <p class="text-gray-600 mb-2">${authors}</p>
                            <p class="text-gray-500 mb-2">Year: ${paper.year || 'N/A'} | Citations: ${citationCount}</p>
                            <p class="text-gray-500 mb-4">Fields of Study: ${fieldsOfStudy}</p>
                            <p class="text-gray-700">${abstract}</p>
                        </div>
                    `;
                });

                if (nextToken) {
                    paginationDiv.classList.remove('hidden');
                } else {
                    paginationDiv.classList.add('hidden');
                }
            } else {
                resultsDiv.innerHTML += `
                    <div class="bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded">
                        No results found.
                    </div>
                `;
                paginationDiv.classList.add('hidden');
            }
        }

        function loadMore() {
            searchPapers(true);
        }

        // Add event listener for Enter key
        document.getElementById('searchQuery').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchPapers();
            }
        });
    </script>
</body>
</html>
